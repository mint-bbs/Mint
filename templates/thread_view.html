<!doctype html>
<html lang="ja">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>{{ data.title }} - Mint</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
		<link href="/css/style.css" rel="stylesheet">
	</head>
	<body style="background-color: #EFEFEF;">
		<div class="thread_member_count">
			<span id="member_count"></span>
		</div>

		<div class="top">
			<a href="/{{ bbs_id }}/">■掲示板に戻る■</a>
			<hr>
			<h1>{{ data.title }}</h1>
		</div>
	
		<div class="res" id="ress">
			{% for _ in res_data %}
				{% if _.mail %}
					<dt>{{ loop.index }} ：<font color="green"><b><a href="mailto:{{ _.mail }}">{{ _.name | safe }}</a></b></font>：{{ _.date }} ID:{{ _.id }}</dt>
				{% else %}
					<dt>{{ loop.index }} ：<font color="green"><b>{{ _.name | safe }}</b></font>：{{ _.date }} ID:{{ _.id }}</dt>
				{% endif %}
				<dd style="overflow-wrap: break-word;"> {{ _.content | safe }} <br><br></dd>
			{% endfor %}
		</div>
		<a id="sita"></a>
		<hr>
		<a href="/{{ bbs_id }}/">掲示板に戻る</a>
		<div class="kakikomi">
			<form method="post" action="/test/bbs.cgi">
				<input type="submit" name="submit" value="書き込む"> <label>名前: <input type="text" name="FROM" placeholder="{{ anonymous_name }}" /></label>
				<label>メール: <input type="mail" name="mail" placeholder="省略可" /></label> <br/>
				<label>内容: <br><textarea name="MESSAGE" cols="60" rows="5"></textarea></label>
				<input type="hidden" name="bbs" value="{{ bbs_id }}">
				<input type="hidden" name="key" value="{{ key }}">
			</form>
		</div>

		<div class="verinfo">
			Mint v{{ ver.ver }}(build num {{ ver.buildnum }}) - CodeName "{{ ver.codename }}"<br>
			<a href="https://github.com/revival-2ch-project/Mint" target="_blank">Mintはオープンソースで開発しています。あなたも開発に参加してみませんか？</a>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
		<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
		<script>
			const socket = io('{{settings.ssloption}}://{{host}}');

			socket.on('connect', () => {
				console.log('connection successful');
				socket.emit('join_room', '{{bbs_id}}_{{key}}');
			});

			socket.on('message_event', (data) => {
				console.log('Received message_event:', data);
				let member_count = document.getElementById("member_count");
				member_count.innerHTML = "現在"+data["clients"]+"人が閲覧中！";
			});

			socket.on('thread_writed', (data) => {
				console.log('Received thread_writed:', data);
				const date = new Date(data["date"]);
				const formattedDate = date.toLocaleString("ja-JP", { year: 'numeric', month: 'numeric', day: 'numeric', weekday: 'short', hour: 'numeric', minute: 'numeric', second: 'numeric', fractionalSecondDigits: 3 });
				if (data["mail"] != "") {
					let content = '<dt>'+data["count"]+' ：<font color="green"><b><a href="mailto:'+data["mail"]+'">'+data["name"]+'</a></b></font>：'+formattedDate+' ID:'+data["id"]+'</dt>';
					content += '<dd style="overflow-wrap: break-word;"> '+data["content"]+' <br><br></dd>';
					document.getElementById("ress").innerHTML += content;
				}else{
					let content = '<dt>'+data["count"]+' ：<font color="green"><b>'+data["name"]+'</b></font>：'+formattedDate+' ID:'+data["id"]+'</dt>';
					content += '<dd style="overflow-wrap: break-word;"> '+data["content"]+' <br><br></dd>';
					document.getElementById("ress").innerHTML += content;
				}
			});
		</script>
	</body>
</html>
